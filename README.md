
# 适用于杭商院的每日健康打卡自动化系统
请使用 *Python 3.10* 及以上版本 , 本仓库除了核心代码外还包含了Web端用以交互。

## 提交原理
通过简单抓包得到企业微信端提交打卡逻辑为三部分。
1. 企业微信授权登录：用户在企业微信打开打卡页面前, 会先访问企业微信用于授权的一个构造URL，用以获取一个`OAUTH_CODE`，同时将这个`OAUTH_CODE`直接作为打卡页面URL的查询参数`code`传入，后端通过此Token验证你的身份，返还正确的表单信息。此`OAUTH_CODE`只能被验证一次, 且 5分钟内有效。
2. 用户填写相关信息。
3. 将表单直接采取POST请求发给页面地址。

## 关键一点
一开始我以为第三步提交表单需要会话`PHPSESSID`进行验证，但是在实际情况中并不需要, 直接提交表单, 后端直接判定表单内的学号信息来对应入库......只能说外包水平过于拉跨。

## 具体实现
直接使用Requests库进行相应请求即可。
1. 用户复制表单链接, **注意：如果在学校官方地址进入, `OAUTH_CODE`在你打开页面时已经被使用！因此需要访问原生的构造URL！** 
2. 使用正则表达式获取链接中的`OAUTH_CODE`, 此时拿到用户授权, 再拼接字符串将其加入查询参数进行访问, 即可获取表单页面， 使用Beautifulsoup库对页面进行解析获取所有表单数据并保存数据库。这一步同时可以拿到会话ID`PHPSESSID`只要会话不过期之后可以一直凭借会话进行访问。
3. 每日定时提交表单数据。收工！


## 代码部分
我再设计整个流程时候考虑了三个方面。
1. Web 端交互。
2. 每日定时提交。
3. 参考心跳机制, 时刻保持`PHPSESSID`会话不过期。  

但是第三步并没有启用，因为提交时候用不到。

1. `app.py`为Flask框架应用文件, 提供页面服务。
